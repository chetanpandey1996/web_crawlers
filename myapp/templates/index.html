<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Get Feedback</title>
    <style>
        ul{
            margin : 0;
            padding: 0;
        }
        body {
            font-family: lato-regular,Arial,Helvetica,sans-serif;
        }
        .user-review-list{
            padding: 25px 20px 30px;
            position: relative;
            min-height: 159px;
        }
        .detail {manali

            margin-top: 10px;
            font-size: 15px;
            color: #000;
        }
        .detaildiv__right {
        padding-right: 10px;
        padding-left: 10px;
    }
    .review__title {
        color: #5da60d;
        font-family: Georgia;
        font-size: 16px;
        font-style: italic;
    }
    .review-list__left {
        width: 140px;
        box-sizing: border-box;
        padding: 25px 0 0;
        height: 100%;
        top: 0;
    }
    .preddiv1 {
        color: #5da60d;
        border: 1px solid #5da60d;
        padding: 10px 3px 10px;
        width: 69px;
        right: 20px;
        top: 25px;
        border-radius: 4px;
    }
    .preddiv2 {
        color: red;
        border: 1px solid red;
        padding: 10px 3px 10px;
        width: 69px;
        right: 20px;
        top: 25px;
        border-radius: 4px;
    }

    .text-center {
        text-align: center;
    }
    li {
        text-align: -webkit-match-parent;
        padding-top: 25px;
        padding-bottom: 30px;
        padding-left: 20px;
        padding-right: 20px;
    }
    .hname{
        color : black;
        font: menu;
    }
    </style>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>
<div class="container">
    <h2>Review Crawler</h2>


    {% for city in acities %}
    <div class="cityname">{{city}}</div>
    <div class="citydata"></div>
    {% endfor %}

</div>
<script>

$(document).ready(function(){

 $.fn.hideshow = function(cntrl){
    console.log($(cntrl).children().toggle());
    if($(cntrl).children().text() == ''){
    var hotel = $(cntrl).parent().prev().text()
    var htl = $(cntrl).parent().prev()
    var city = $(cntrl).parent().parent().prev().text()
    console.log(htl)
    tda_data= $($(htl).next().children()[1]).children()
    mmt_data= $($(htl).next().children()[2]).children()
    $.ajax({
						type: 'POST',
                        data: {
                             csrfmiddlewaretoken : '{{csrf_token}}',
                             hotel_name : hotel,
                             city_name : city
                             },
                        url:'/review/',
                        datatype:'json'
                    })
                    .done(function(data){
                     $(tda_data).html("");
                     $(mmt_data).html("");

                        $.each(data, function( key, values ) {
                            $.each(values.data, function( key, value ) {
                                if(value.from == 'TripAdvisor'){
                                    $(tda_data).append("<br> Review : "+value.head+"<br> Detail : "+value.detail+"<br> Prediction : "+value.prediction+"<br><hr>");
                                }else if(value.from == 'MakeMyTrip'){
                                    $(mmt_data).append("<br> Review : "+value.head+"<br> Detail : "+value.detail+"<br> Prediction : "+value.prediction+"<br><hr>");
                                }
                                });

                        });



                   });
    }
 }

    $('.cityname').click(function(){
       if($(this).next().text() != '')
        { $(this).next().toggle() }

      var city =  $(this).text()
      var cntrl = this
      if($(this).next().text() == '')
      {
      $.ajax({
						type: 'POST',
                        data: {
                             csrfmiddlewaretoken : '{{csrf_token}}',
                             cityname :city
                             },
                        url:'/city/',
                        datatype:'json'
                    })
                    .done(function(data){
                    console.log($(cntrl).next())
                     $(cntrl).next().html("");

                        $.each(data, function( key, values ) {

                            $(cntrl).next().append("<div class='hname'>"+values.name+"</div><div class='all'>Total : "+ values.total + "<br><div class='ttrip' onclick = '$.fn.hideshow(this)'>Trip Advisor : "+ values.tda +"<div class='tad_in'></div></div><div class='mtrip' onclick='$.fn.hideshow(this)'>MakeMyTrip : "+ values.mmt+"<div class='mmt_in'></div></div></div><hr>")
                        });
                        $('.tad_in').hide();
                        $('.mmt_in').hide();
                   });
      }
    });

});
</script>
</body>
</html>